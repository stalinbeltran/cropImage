<ion-header>
  <ion-toolbar>
    <ion-buttons start>
      <button ion-button color="danger" (click)="reset()">
        Reset
      </button>
    </ion-buttons>
    <ion-title>Ionic CropperJS</ion-title>
    <ion-buttons end>
      <button ion-button icon-only color="danger" (click)="clear()">
        <ion-icon name="close"></ion-icon>
      </button>
      <button ion-button icon-only color="secondary" (click)="save()">
        <ion-icon name="checkmark"></ion-icon>
      </button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <p>
    <!-- Below are a series of inputs which allow file selection and interaction with the cropper api -->
        <input type="file" id="fileInput" accept="image/*" />
        <input type="button" id="btnCrop" value="Crop" />
        <input type="button" id="btnRestore" value="Restore" />
    </p>
    <div>
      <canvas id="canvas">
        Your browser does not support the HTML5 canvas element.
      </canvas>
    </div>		
    
    <div id="result"></div>
    
    <br />
    <br />
    <hr />
    <p>If you find this demo useful, please consider <a href="https://www.paypal.com/cgi-bin/webscr?business=rob@robgravelle.com&cmd=_xclick&currency_code=USD&amount=1.00&item_name=donating%20%241%20dollar" target="_blank">donating $1 dollar</a> for a coffee using the button below or purchasing one of my songs from <a href="https://ax.itunes.apple.com/WebObjects/MZSearch.woa/wa/search?term=rob%20gravelle" target="_blank">iTunes.com</a> or <a href="http://www.amazon.com/s/ref=ntt_srch_drd_B001ES9TTK?ie=UTF8&field-keywords=Rob%20Gravelle&index=digital-music&search-type=ss" target="_blank">Amazon.com</a> for only 0.99 cents each. I have also released CDs with my band <a href="https://www.cdbaby.com/Artist/IvoryKnight" target="_blank">Ivory Knight</a> and Annihilator main-man Jeff Waters.</p>
    <p>Rob uses and recommends <a href="http://www.mochahost.com/2425.html" target="_blank">MochaHost</a>, which provides Web Hosting for as low as $1.95 per month, as well as unlimited emails and disk space!</p>
        
    
  


</ion-content>

<script>
console.log("entramos")
  var canvas  = $("#canvas"),
      context = canvas.get(0).getContext("2d"),
      $result = $('#result');

  $('#fileInput').on( 'change', function(){
      if (this.files && this.files[0]) {
        if ( this.files[0].type.match(/^image\//) ) {
          var reader = new FileReader();
          reader.onload = function(evt) {
            var img = new Image();
            img.onload = function() {
              context.canvas.height = img.height;
              context.canvas.width  = img.width;
              context.drawImage(img, 0, 0);
              var cropper = canvas.cropper({
                aspectRatio: 16 / 9
              });
              $('#btnCrop').click(function() {
                  // Get a string base 64 data url
                  var croppedImageDataURL = canvas.cropper('getCroppedCanvas').toDataURL("image/png"); 
                  $result.append( $('<img>').attr('src', croppedImageDataURL) );
              });
              $('#btnRestore').click(function() {
                canvas.cropper('reset');
                $result.empty();
              });
            };
            img.src = evt.target.result;
          };
          reader.readAsDataURL(this.files[0]);
        }
        else {
          alert("Invalid file type! Please select an image file.");
        }
      }
      else {
        alert('No file(s) selected.');
      }
  });

</script>